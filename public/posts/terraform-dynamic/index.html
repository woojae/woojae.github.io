<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>How to Use Terraform Dynamics | Woojae</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="How to Use Terraform Dynamics Today, we&rsquo;re focusing on a particularly powerful feature: Terraform Dynamics. This tool is essential for writing more efficient and maintainable code by helping you adhere to the DRY (Don&rsquo;t Repeat Yourself) principle.
Why You Should Care About Terraform Dynamics Let’s get one thing straight: if you enjoy writing the same block of code over and over again, this post isn’t for you. Terraform dynamics is for the lazy (read: efficient) engineers who believe that copy-pasting is a crime punishable by endless debugging sessions.">
    <meta name="generator" content="Hugo 0.132.1">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="https://woojae.github.io/posts/terraform-dynamic/">
    

    <meta property="og:url" content="https://woojae.github.io/posts/terraform-dynamic/">
  <meta property="og:site_name" content="Woojae">
  <meta property="og:title" content="How to Use Terraform Dynamics">
  <meta property="og:description" content="How to Use Terraform Dynamics Today, we’re focusing on a particularly powerful feature: Terraform Dynamics. This tool is essential for writing more efficient and maintainable code by helping you adhere to the DRY (Don’t Repeat Yourself) principle.
Why You Should Care About Terraform Dynamics Let’s get one thing straight: if you enjoy writing the same block of code over and over again, this post isn’t for you. Terraform dynamics is for the lazy (read: efficient) engineers who believe that copy-pasting is a crime punishable by endless debugging sessions.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-27T09:40:33+09:00">
    <meta property="article:modified_time" content="2024-08-27T09:40:33+09:00">

  <meta itemprop="name" content="How to Use Terraform Dynamics">
  <meta itemprop="description" content="How to Use Terraform Dynamics Today, we’re focusing on a particularly powerful feature: Terraform Dynamics. This tool is essential for writing more efficient and maintainable code by helping you adhere to the DRY (Don’t Repeat Yourself) principle.
Why You Should Care About Terraform Dynamics Let’s get one thing straight: if you enjoy writing the same block of code over and over again, this post isn’t for you. Terraform dynamics is for the lazy (read: efficient) engineers who believe that copy-pasting is a crime punishable by endless debugging sessions.">
  <meta itemprop="datePublished" content="2024-08-27T09:40:33+09:00">
  <meta itemprop="dateModified" content="2024-08-27T09:40:33+09:00">
  <meta itemprop="wordCount" content="693">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="How to Use Terraform Dynamics">
  <meta name="twitter:description" content="How to Use Terraform Dynamics Today, we’re focusing on a particularly powerful feature: Terraform Dynamics. This tool is essential for writing more efficient and maintainable code by helping you adhere to the DRY (Don’t Repeat Yourself) principle.
Why You Should Care About Terraform Dynamics Let’s get one thing straight: if you enjoy writing the same block of code over and over again, this post isn’t for you. Terraform dynamics is for the lazy (read: efficient) engineers who believe that copy-pasting is a crime punishable by endless debugging sessions.">

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Woojae
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/posts/" title="Post page">
              Post
            </a>
          </li>
          
        </ul>
      
      
<div class="ananke-socials">
  
</div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside>
      










  <div id="sharing" class="mt3 ananke-socials">
    
  </div>


      <h1 class="f1 athelas mt3 mb1">How to Use Terraform Dynamics</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2024-08-27T09:40:33+09:00">August 27, 2024</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><h3 id="how-to-use-terraform-dynamics">How to Use Terraform Dynamics</h3>
<p>Today, we&rsquo;re focusing on a particularly powerful feature: <strong>Terraform Dynamics</strong>. This tool is essential for writing more efficient and maintainable code by helping you adhere to the DRY (Don&rsquo;t Repeat Yourself) principle.</p>
<h4 id="why-you-should-care-about-terraform-dynamics">Why You Should Care About Terraform Dynamics</h4>
<p>Let’s get one thing straight: if you enjoy writing the same block of code over and over again, this post isn’t for you. Terraform dynamics is for the <em>lazy</em> (read: efficient) engineers who believe that copy-pasting is a crime punishable by endless debugging sessions.</p>
<p>You see, in the real world, you’ll often find yourself needing to spin up similar resources—multiple EC2 instances, security groups, VPCs, whatever. Now, you could write a separate block for each one, but that’s like bringing a spoon to a knife fight. Instead, let’s use Terraform dynamics to bring some serious automation kung-fu to our code.</p>
<h4 id="enter-the-for_each-loop-your-new-best-friend">Enter the <code>for_each</code> Loop: Your New Best Friend</h4>
<p>First up, the <code>for_each</code> loop. This allows you to iterate over a map or set and create resources dynamically. Imagine you need to create three S3 buckets. Do you really want to write out the entire <code>aws_s3_bucket</code> block three times? Didn’t think so. Here’s how you can avoid that:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-hcl" data-lang="hcl"><span style="display:flex;"><span><span style="color:#66d9ef">variable</span> <span style="color:#e6db74">&#34;bucket_names&#34;</span> {
</span></span><span style="display:flex;"><span>  type    <span style="color:#f92672">=</span> <span style="color:#66d9ef">list</span>(<span style="color:#66d9ef">string</span>)
</span></span><span style="display:flex;"><span>  default <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;bucket1&#34;, &#34;bucket2&#34;, &#34;bucket3&#34;</span>]
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_s3_bucket&#34; &#34;buckets&#34;</span> {
</span></span><span style="display:flex;"><span>  for_each <span style="color:#f92672">=</span> <span style="color:#66d9ef">toset</span>(<span style="color:#66d9ef">var</span>.<span style="color:#66d9ef">bucket_names</span>)
</span></span><span style="display:flex;"><span>  bucket   <span style="color:#f92672">=</span> <span style="color:#66d9ef">each</span>.<span style="color:#66d9ef">value</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>And just like that, you’ve created three buckets with a single resource block. What’s that I hear? Oh, just the sound of your coworkers’ jaws hitting the floor when they see how much cleaner your code is.</p>
<h4 id="dynamic-blocks-because-writing-nested-blocks-by-hand-is-for-suckers">Dynamic Blocks: Because Writing Nested Blocks by Hand is for Suckers</h4>
<p>Next up: dynamic blocks. Imagine you’re setting up an AWS security group, and you’ve got a bunch of ingress rules to add. Sure, you could write out each rule manually, but why do that when you can let Terraform do the heavy lifting?</p>
<p>Here’s how you’d traditionally write a security group:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-hcl" data-lang="hcl"><span style="display:flex;"><span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_security_group&#34; &#34;example&#34;</span> {
</span></span><span style="display:flex;"><span>  name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;example-sg&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">ingress</span> {
</span></span><span style="display:flex;"><span>    from_port   <span style="color:#f92672">=</span> <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>    to_port     <span style="color:#f92672">=</span> <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>    protocol    <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;tcp&#34;</span>
</span></span><span style="display:flex;"><span>    cidr_blocks <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;0.0.0.0/0&#34;</span>]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">ingress</span> {
</span></span><span style="display:flex;"><span>    from_port   <span style="color:#f92672">=</span> <span style="color:#ae81ff">443</span>
</span></span><span style="display:flex;"><span>    to_port     <span style="color:#f92672">=</span> <span style="color:#ae81ff">443</span>
</span></span><span style="display:flex;"><span>    protocol    <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;tcp&#34;</span>
</span></span><span style="display:flex;"><span>    cidr_blocks <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;0.0.0.0/0&#34;</span>]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>That’s cute and all, but watch what happens when we introduce a dynamic block:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-hcl" data-lang="hcl"><span style="display:flex;"><span><span style="color:#66d9ef">variable</span> <span style="color:#e6db74">&#34;ingress_rules&#34;</span> {
</span></span><span style="display:flex;"><span>  type <span style="color:#f92672">=</span> <span style="color:#66d9ef">list</span>(<span style="color:#66d9ef">object</span>({
</span></span><span style="display:flex;"><span>    from_port   <span style="color:#f92672">=</span> <span style="color:#66d9ef">number</span>
</span></span><span style="display:flex;"><span>    to_port     <span style="color:#f92672">=</span> <span style="color:#66d9ef">number</span>
</span></span><span style="display:flex;"><span>    protocol    <span style="color:#f92672">=</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>    cidr_blocks <span style="color:#f92672">=</span> <span style="color:#66d9ef">list</span>(<span style="color:#66d9ef">string</span>)
</span></span><span style="display:flex;"><span>  }))
</span></span><span style="display:flex;"><span>  default <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    { from_port <span style="color:#f92672">=</span> 80, to_port <span style="color:#f92672">=</span> 80, protocol <span style="color:#f92672">=</span> &#34;tcp&#34;, cidr_blocks <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;0.0.0.0/0&#34;</span>] },
</span></span><span style="display:flex;"><span>    { from_port <span style="color:#f92672">=</span> 443, to_port <span style="color:#f92672">=</span> 443, protocol <span style="color:#f92672">=</span> &#34;tcp&#34;, cidr_blocks <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;0.0.0.0/0&#34;</span>] }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_security_group&#34; &#34;example&#34;</span> {
</span></span><span style="display:flex;"><span>  name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;example-sg&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">dynamic</span> <span style="color:#e6db74">&#34;ingress&#34;</span> {
</span></span><span style="display:flex;"><span>    for_each <span style="color:#f92672">=</span> <span style="color:#66d9ef">var</span>.<span style="color:#66d9ef">ingress_rules</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">content</span> {
</span></span><span style="display:flex;"><span>      from_port   <span style="color:#f92672">=</span> <span style="color:#66d9ef">ingress</span>.<span style="color:#66d9ef">value</span>.<span style="color:#66d9ef">from_port</span>
</span></span><span style="display:flex;"><span>      to_port     <span style="color:#f92672">=</span> <span style="color:#66d9ef">ingress</span>.<span style="color:#66d9ef">value</span>.<span style="color:#66d9ef">to_port</span>
</span></span><span style="display:flex;"><span>      protocol    <span style="color:#f92672">=</span> <span style="color:#66d9ef">ingress</span>.<span style="color:#66d9ef">value</span>.<span style="color:#66d9ef">protocol</span>
</span></span><span style="display:flex;"><span>      cidr_blocks <span style="color:#f92672">=</span> <span style="color:#66d9ef">ingress</span>.<span style="color:#66d9ef">value</span>.<span style="color:#66d9ef">cidr_blocks</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Boom! Now you can add as many ingress rules as you want, without having to copy and paste a single line. You’re welcome.</p>
<h4 id="conditionals-because-terraform-should-be-as-indecisive-as-you-are">Conditionals: Because Terraform Should Be as Indecisive as You Are</h4>
<p>Ever had to create a resource <em>only if</em> some condition is met? Maybe you want to spin up a costly RDS instance only if you’re running in production, but not in dev or staging. Normally, you’d have to wrap your resource block in some convoluted logic that’s harder to read than a teenager’s text messages. But with Terraform dynamics, you can use conditionals to simplify this process:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-hcl" data-lang="hcl"><span style="display:flex;"><span><span style="color:#66d9ef">variable</span> <span style="color:#e6db74">&#34;environment&#34;</span> {
</span></span><span style="display:flex;"><span>  type    <span style="color:#f92672">=</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>  default <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dev&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_db_instance&#34; &#34;example&#34;</span> {
</span></span><span style="display:flex;"><span>  count <span style="color:#f92672">=</span> var.environment <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;production&#34;</span> <span style="color:#960050;background-color:#1e0010">?</span> <span style="color:#ae81ff">1</span> <span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#ae81ff">0</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  # Other parameters here
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><p>Now, Terraform will only create the RDS instance if you’re in the production environment. If not, it’ll skip right over it, leaving your dev and staging environments blissfully free of unnecessary AWS bills. What a time to be alive!</p>
<h4 id="wrap-up-dont-be-a-terraform-caveman">Wrap-Up: Don’t Be a Terraform Caveman</h4>
<p>In summary, Terraform dynamics is your key to writing cleaner, smarter, and more maintainable infrastructure code. Whether it’s looping through resources, generating dynamic blocks, or adding conditionals, these features will save you time and headaches in the long run. So go ahead, be lazy (I mean, efficient), and let Terraform do the heavy lifting. Your future self, and your coworkers, will thank you.</p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://woojae.github.io/" >
    &copy;  Woojae 2024 
  </a>
    <div>
<div class="ananke-socials">
  
</div>
</div>
  </div>
</footer>

  </body>
</html>
